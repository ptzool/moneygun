<% content_for :title, "Task Timetrackings" %>

<%= render PageComponent.new(title: "Task Timetrackings for #{@task.name}") do |component| %>
  <% component.with_action_list do %>
    <%= link_to "New Time Entry", new_organization_task_task_timetracking_path(@organization, @task), class: "btn btn-primary" %>
    <%= link_to "Calendar View", calendar_organization_task_task_timetrackings_path(@organization, @task), class: "btn btn-secondary" %>
    <%= link_to "Back to Task", organization_task_path(@organization, @task), class: "btn btn-secondary" %>
  <% end %>

  <div class="card shadow mt-4">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-4">Time Entries</h3>
      
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if @task_timetrackings.any? %>
              <% @task_timetrackings.order(date: :desc, start: :desc).each do |task_timetracking| %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= task_timetracking.date %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= task_timetracking.start&.strftime('%H:%M') %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= task_timetracking.end&.strftime('%H:%M') %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= number_with_precision(task_timetracking.duration_in_hours, precision: 2) %> hrs</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                    <%= link_to "Show", organization_task_task_timetracking_path(@organization, @task, task_timetracking), class: "text-indigo-600 hover:text-indigo-900" %>
                    <%= link_to "Edit", edit_organization_task_task_timetracking_path(@organization, @task, task_timetracking), class: "text-indigo-600 hover:text-indigo-900" %>
                    <%= button_to "Delete", organization_task_task_timetracking_path(@organization, @task, task_timetracking), method: :delete, class: "text-red-600 hover:text-red-900 bg-transparent border-0 p-0 inline", data: { turbo_confirm: "Are you sure?" } %>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No time entries found. <a href="<%= new_organization_task_task_timetracking_path(@organization, @task) %>" class="text-indigo-600 hover:text-indigo-900">Add one</a> or use the <a href="<%= calendar_organization_task_task_timetrackings_path(@organization, @task) %>" class="text-indigo-600 hover:text-indigo-900">Calendar View</a></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>
